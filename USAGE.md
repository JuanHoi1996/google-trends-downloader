# 使用指南

## 📖 详细使用说明

### 界面布局

程序采用左右分栏布局：

```
┌─────────────────────────────────────────────────┐
│     Google Trends 数据下载器 v1.4.2             │
│   无预热版本 - 推荐等待30-60秒                   │
├──────────────────┬──────────────────────────────┤
│  配置区域        │  日志和进度区域              │
│                  │                              │
│  ┌────────────┐  │  进度条: ████████░░ 80%      │
│  │关键词设置  │  │                              │
│  │            │  │  ┌──────────────────────┐   │
│  │MOLLY       │  │  │[12:00:00] 开始下载   │   │
│  │CRYBABY     │  │  │[12:00:05] ✅ MOLLY   │   │
│  │LABUBU      │  │  │[12:00:35] 等待30秒   │   │
│  │...         │  │  │[12:01:05] ✅ CRYBABY │   │
│  └────────────┘  │  │...                   │   │
│                  │  └──────────────────────┘   │
│  ┌────────────┐  │                              │
│  │输出设置    │  │                              │
│  │目录: ...   │  │                              │
│  └────────────┘  │                              │
│                  │                              │
│  ┌────────────┐  │                              │
│  │下载参数    │  │                              │
│  │等待: 30-60s│  │                              │
│  │重试: 3次   │  │                              │
│  └────────────┘  │                              │
│                  │                              │
│  [开始下载]      │                              │
│  [停止]          │                              │
│  [保存配置]      │                              │
└──────────────────┴──────────────────────────────┘
```

### 第一次使用

1. **启动程序**
   - 双击 `GoogleTrendsDownloader.exe`（如果使用打包版本）
   - 或运行 `python google_trends_gui_no_warmup.py`

2. **查看默认设置**
   - 程序已预设 8 个 Popmart 玩偶关键词
   - 输出目录默认为程序所在目录
   - 等待时间：30-60 秒
   - 最大重试：3 次

3. **直接开始**
   - 如果默认设置符合需求，直接点击"开始下载"
   - 观察右侧日志区域的实时反馈

### 修改关键词

在左侧"关键词设置"文本框中：

```
MOLLY
CRYBABY
LABUBU
SKULLPANDA
HIRONO
Peach Riot
TWINKLE
DIMOO
```

**注意事项**：
- 每行一个关键词
- 支持中英文
- 支持空格（如 "Peach Riot"）
- 大小写敏感（建议与 Google Trends 官网一致）

### 设置输出目录

1. 点击"浏览"按钮
2. 选择想要保存 CSV 文件的文件夹
3. 路径会自动填入输入框

**提示**：
- 默认保存在程序当前目录
- 文件名格式：`google_trends_YYYYMMDD_HHMMSS.csv`
- 例如：`google_trends_20241124_143025.csv`

### 调整下载参数

#### 关键词间等待时间

**推荐设置**：30-60 秒

```
最小值: 30 秒  ←→  最大值: 60 秒
```

程序会在这个范围内随机选择等待时间。

**为什么需要等待？**
- Google Trends API 有限速保护
- 等待时间越长，成功率越高
- 30-60 秒可达到 95%+ 成功率

**不同场景的建议**：

| 场景 | 等待时间 | 成功率 | 总耗时（8个关键词） |
|------|----------|--------|---------------------|
| 快速测试 | 15-30秒 | ~80% | ~3-4分钟 |
| **推荐设置** | **30-60秒** | **95%+** | **5-8分钟** |
| 保守设置 | 60-90秒 | 99%+ | 10-12分钟 |

#### 最大重试次数

**推荐设置**：3 次

```
重试次数: 3 次
```

**重试机制说明**：
- 第 1 次：立即尝试
- 第 2 次：等待 30 秒后重试
- 第 3 次：等待 60 秒后重试
- 第 4 次：等待 120 秒后重试

每次重试都会创建全新的会话，提高成功率。

### 开始下载

1. **点击"开始下载"按钮**

2. **观察日志输出**（右侧区域）：

```
[12:00:00] ================================================
[12:00:00] 📊 开始下载 8 个关键词
[12:00:00] ⚠️ 无预热模式 - 每个关键词使用独立会话
[12:00:00] ================================================

[12:00:00] 📊 [1/8] MOLLY
[12:00:00]     📥 正在下载: MOLLY
[12:00:05]     ✅ MOLLY 下载成功 (shape: (261, 1))
[12:00:05]     ⏳ 等待 45.3 秒...

[12:00:50] 📊 [2/8] CRYBABY
[12:00:50]     📥 正在下载: CRYBABY
[12:00:55]     ✅ CRYBABY 下载成功 (shape: (261, 1))
[12:00:55]     ⏳ 等待 52.1 秒...

...
```

3. **查看进度条**
   - 顶部进度条实时更新
   - 显示当前完成百分比

4. **等待完成**
   - 所有关键词下载完成后，会弹出提示框
   - CSV 文件自动保存到指定目录

### 处理下载失败

如果遇到限速（429 错误）：

```
[12:01:30]     🚫 遇到限速 (429): LABUBU (首次尝试失败)
[12:01:30]     💡 将使用指数退避重试...
[12:01:30]     🔄 第 1 次重试 (共 3 次重试机会): LABUBU
[12:01:30]     ⏳ 指数退避等待: 30.0 秒
[12:02:00]     📥 正在下载: LABUBU
[12:02:05]     ✅ LABUBU 下载成功 (shape: (261, 1))
```

**自动处理**：
- 程序会自动重试
- 使用指数退避策略
- 每次重试创建新会话

**如果多次重试仍失败**：
1. 增加等待时间（如改为 60-90 秒）
2. 减少关键词数量
3. 稍后再试（可能是 IP 被临时限制）

### 中途停止

点击"停止"按钮可以中途停止下载：

```
[12:03:00] ⏹️ 用户中断下载
[12:03:00] ================================================
[12:03:00] 📊 下载完成
[12:03:00] ✅ 成功: 3/8
[12:03:00]    ['MOLLY', 'CRYBABY', 'LABUBU']
[12:03:00] ❌ 失败: 5
[12:03:00]    ['SKULLPANDA', 'HIRONO', 'Peach Riot', 'TWINKLE', 'DIMOO']
[12:03:00] ================================================
```

**注意**：
- 已下载的数据会保存
- 未下载的关键词会标记为失败

### 保存配置

点击"保存配置"按钮：

- 关键词列表
- 输出目录
- 等待时间
- 重试次数

会保存到 `trends_config.json` 文件中。

**下次打开程序时**：
- 自动加载上次的配置
- 无需重新设置

## 📊 查看下载的数据

### 文件位置

在您设置的输出目录中，找到类似这样的文件：

```
google_trends_20241124_143025.csv
```

### 用 Excel 打开

1. 右键点击 CSV 文件
2. 选择"打开方式" → "Excel"
3. 查看数据

### 数据格式

| date       | MOLLY | CRYBABY | LABUBU | SKULLPANDA | ... |
|------------|-------|---------|--------|------------|-----|
| 2019-12-01 | 44    | 32      | 15     | 28         | ... |
| 2019-12-08 | 46    | 35      | 16     | 30         | ... |
| 2019-12-15 | 48    | 33      | 18     | 29         | ... |
| ...        | ...   | ...     | ...    | ...        | ... |

**列说明**：
- `date`：日期（每周一个数据点）
- 其他列：各关键词的搜索热度（0-100）

**数值含义**：
- 0：该时间段内搜索量最低
- 100：该时间段内搜索量最高（峰值）
- 其他数值：相对于峰值的百分比

**重要提示**：
- 每个关键词的数值是**独立**计算的
- 不同关键词之间的数值**不能直接比较**
- 例如：MOLLY 的 50 ≠ LABUBU 的 50

## 🔧 高级技巧

### 批量下载多组关键词

如果需要下载很多关键词（如 20+ 个）：

**方法 1：分批下载**
1. 第一批：8 个关键词
2. 等待 10 分钟
3. 第二批：8 个关键词
4. ...

**方法 2：增加等待时间**
- 设置等待时间为 60-90 秒
- 一次性下载所有关键词
- 总耗时会更长，但成功率更高

### 定期更新数据

如果需要每周/每月更新数据：

1. 保存配置（关键词列表）
2. 定期运行程序
3. 下载最新数据
4. 比较不同时间点的 CSV 文件

### 合并多个 CSV 文件

如果分批下载了多个 CSV 文件，可以用 Python 合并：

```python
import pandas as pd

# 读取两个文件
df1 = pd.read_csv('google_trends_20241124_143025.csv', index_col=0)
df2 = pd.read_csv('google_trends_20241124_150000.csv', index_col=0)

# 合并（按日期对齐）
merged = df1.join(df2, how='outer')

# 保存
merged.to_csv('google_trends_merged.csv')
```

## ⚠️ 注意事项

### 1. 网络要求

- 需要能访问 Google Trends（trends.google.com）
- 如果无法访问，需要使用 VPN

### 2. 限速说明

Google Trends API 有以下限制：
- 短时间内请求过多会被限速（429 错误）
- IP 地址可能被临时封禁（通常 1-24 小时）
- 使用合理的等待时间可以避免大部分问题

### 3. 数据更新频率

- Google Trends 数据每天更新
- 最新数据可能有 1-3 天延迟
- 历史数据不会改变

### 4. 数据准确性

- v1.4.2 版本使用无预热模式
- 数据与 Google Trends 官网一致
- 如果发现数据异常，请检查：
  - 关键词拼写是否正确
  - 是否使用了最新版本
  - 网络连接是否正常

## 🆘 常见问题

### Q: 为什么第一个关键词总是失败？

**A**: 可能是"冷启动"问题。解决方法：
- 增加等待时间到 40-60 秒
- 或者先下载一个不重要的关键词作为"预热"

### Q: 可以同时下载多个时间范围吗？

**A**: 当前版本固定为"过去 5 年"。如需其他时间范围，需要修改代码中的 `timeframe` 参数。

### Q: 数据中有缺失值怎么办？

**A**: 
- 缺失值表示该时间段搜索量为 0 或数据不可用
- 可以用 0 填充：`df.fillna(0)`
- 或用前后值插值：`df.interpolate()`

### Q: 可以下载中文关键词吗？

**A**: 可以！只需在关键词列表中输入中文即可。

### Q: 打包的 exe 文件很大（30+ MB）？

**A**: 这是正常的，因为包含了：
- Python 解释器
- 所有依赖库（pandas, pytrends, tkinter）
- 如需减小体积，可以使用虚拟环境打包

## 📞 获取帮助

如遇到问题：

1. 查看日志输出（右侧日志区域）
2. 检查网络连接
3. 确认使用最新版本
4. 在 GitHub 提交 Issue

---

**祝使用愉快！📊**

